pipeline {
 agent any 
 stages {
   stage ('deploying the web app') {
    steps {
       script{
           withCredentials([[$class: 'AmazonWebServicesCredentialsBinding', credentialsId: 'eks-credentials']]) {
          sh """
            export AWS_ACCESS_KEY_ID=$AWS_ACCESS_KEY_ID
            export AWS_SECRET_ACCESS_KEY=$AWS_SECRET_ACCESS_KEY
            export AWS_DEFAULT_REGION=us-east-2
            aws eks update-kubeconfig --region us-east-2 --name staging-demo
            kubeclt apply -f web/web-namespace.yml
            kubeclt apply -f web/we-deployment.yml
            kubeclt apply -f web/web-service.yml
            kubeclt apply -f web/web-ingress.yml
         """
       }
     }
   }
   }
   stage ('deploying of the mysql') {
    steps {
       script{
          withCredentials([[$class: 'AmazonWebServicesCredentialsBinding', credentialsId: 'eks-credentials']]) {
          sh """
            export AWS_ACCESS_KEY_ID=$AWS_ACCESS_KEY_ID
            export AWS_SECRET_ACCESS_KEY=$AWS_SECRET_ACCESS_KEY
            export AWS_DEFAULT_REGION=us-east-2
            aws eks update-kubeconfig --region us-east-2 --name staging-demo
            kubeclt apply -f db/db-deployment.yml
            kubeclt apply -f db/db-service.yml
         """
       }
     }
   }
 }
}
}


